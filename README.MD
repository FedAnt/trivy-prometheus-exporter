```markdown
# Trivy Prometheus Exporter

[![License](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)
[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)](https://www.python.org/)

–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤ Trivy –≤ –º–µ—Ç—Ä–∏–∫–∏ Prometheus. –°–æ–±–∏—Ä–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ JSON-–æ—Ç—á–µ—Ç–æ–≤ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö –≤ —Ñ–æ—Ä–º–∞—Ç–µ, –ø—Ä–∏–≥–æ–¥–Ω–æ–º –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ Prometheus.

## üöÄ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:
  - **–û–±—Ä–∞–∑—ã Docker**: –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã
  - **Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä—ã**: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏
  - **RBAC-–æ—Ü–µ–Ω–∫–∏**: –†–æ–ª–∏ –∏ ClusterRoles
- –ú–µ—Ç—Ä–∏–∫–∏:
  - –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –ø–æ —É—Ä–æ–≤–Ω—é –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ (CRITICAL, HIGH, MEDIUM, LOW)
  - –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –æ–±—Ä–∞–∑–∞—Ö
  - –û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
  - –ü—Ä–æ–±–ª–µ–º—ã RBAC-–ø–æ–ª–∏—Ç–∏–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤—ã—Ö –æ—Ç—á–µ—Ç–æ–≤

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/FedAnt/trivy-prometheus-exporter.git
cd trivy-prometheus-exporter
```

2. –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑:
```bash
docker build -t trivy-exporter .
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä
```bash
docker run -d \
    -p 8000:8000 \
    -v /home/user/trivy-prometheus-exporter/json:/scans \
    -e TRIVY_SCAN_DIR=/scans \
    -e EXPORTER_PORT=8000 \
    -e LOG_LEVEL=ERROR \
    --name trivy-prometheus-exporter \
    trivy-prometheus-exporter
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é      | –û–ø–∏—Å–∞–Ω–∏–µ                          |
|-------------------------|-------------------|-----------------------------------|
| `TRIVY_SCAN_DIR`        | `/scans`          | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤ Trivy      |
| `EXPORTER_PORT`         | `8000`            | –ü–æ—Ä—Ç HTTP-—Å–µ—Ä–≤–µ—Ä–∞                 |
| `EXPORTER_HOST`         | `0.0.0.0`         | –•–æ—Å—Ç –¥–ª—è –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è            |
| `LOG_LEVEL`             | `INFO`            | –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG/INFO)  |

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```ini
TRIVY_SCAN_DIR=/path/to/scans
LOG_LEVEL=DEBUG
```

## üñ• –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞
```bash
python main.py
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏
```bash
curl http://localhost:8000/health
# OK

curl http://localhost:8000/metrics
# trivy_image_vulnerabilities{severity="HIGH",...} 12
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Trivy

–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–∑–∞:
```bash
trivy image --format json -o /scans/image_scan.json your-image:tag
```

–î–ª—è Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞:
```bash
trivy k8s --format json -o /scans/cluster_scan.json cluster
```

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Prometheus

–î–æ–±–∞–≤—å—Ç–µ –≤ `prometheus.yml`:
```yaml
scrape_configs:
  - job_name: 'trivy-prometheus-exporter'
    static_configs:
      - targets: ['exporter-host:8000']
```

## üìä –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana

–ò–º–ø–æ—Ä—Ç–∏—Ä–µ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ `Trivy_Workload Vulnerabilities.json`

## üìà –ü—Ä–∏–º–µ—Ä –º–µ—Ç—Ä–∏–∫

```prometheus
# –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –æ–±—Ä–∞–∑–æ–≤
trivy_image_vulnerabilities{severity="CRITICAL", image_repository="nginx", namespace="debian"} 3

# –°–µ–∫—Ä–µ—Ç—ã –≤ –æ–±—Ä–∞–∑–∞—Ö
trivy_image_exposedsecrets{image_repository="redis", image_tag="6.2"} 2

# –û—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
trivy_resource_configaudits{severity="HIGH", namespace="default"} 5
```

## Workflow –¥–ª—è CI/CD

–ü—Ä–∏–º–µ—Ä –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–ª—è jenkins –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ñ–∞–π–ª–µ `pipelineTrivyImageScanner.groovy`

## üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
TODO
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
```bash
TODO
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –≤ —Ñ–∞–π–ª–µ [![License](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT).

---
